<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Seamless Dash - Seamex</title>
    <style>
        :root { --red: #A01018; --gold: #FFC107; --blue: #0984e3; --bg-current: #f0f2f5; }
        
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: var(--bg-current); font-family: 'Segoe UI', system-ui, sans-serif; touch-action: none; transition: background-color 2s ease; }
        canvas { display: block; position: absolute; top: 0; left: 0; z-index: 1; width: 100%; height: 100%; }

        /* UI State Control */
        #ui-layer { position: absolute; inset: 0; z-index: 10; pointer-events: none; display: flex; align-items: center; justify-content: center; }
        .screen-box { 
            background: white; padding: 20px; border-radius: 20px; width: 85%; max-width: 340px; 
            text-align: center; pointer-events: auto; box-shadow: 0 15px 40px rgba(0,0,0,0.2); 
            border-top: 8px solid var(--red); display: none; flex-direction: column;
        }

        body.state-menu #start-screen { display: flex; }
        body.state-paused #pause-screen { display: flex; }
        body.state-gameover #game-over-screen { display: flex; }
        body.state-playing #game-hud { display: flex !important; }

        /* Branding & Text */
        .responsive-logo { width: 130px; height: auto; margin: 5px auto; display: block; }
        .game-title { color: var(--red); font-size: 24px; font-weight: 900; margin: 0; text-transform: uppercase; }
        .powered-text { font-size: 10px; color: #888; font-weight: bold; margin-bottom: 5px; }

        /* Inputs */
        .input-group { margin-bottom: 12px; text-align: left; }
        input { width: 100%; padding: 12px; border: 2px solid #eee; border-radius: 12px; font-size: 16px; box-sizing: border-box; }
        .val-err { color: var(--red); font-size: 11px; font-weight: bold; visibility: hidden; height: 12px; }

        /* Buttons */
        .main-btn, .secondary-btn { 
            background: linear-gradient(135deg, var(--gold), var(--red)); color: white; border: none; 
            padding: 14px; border-radius: 50px; font-weight: 800; width: 100%; cursor: pointer; 
            margin-top: 8px; font-size: 15px; text-transform: uppercase; box-shadow: 0 4px 12px rgba(160,16,24,0.3);
        }
        .secondary-btn { background: #fff; border: 2px solid #ddd; color: #444; box-shadow: none; }

        /* HUD */
        #game-hud { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: none; flex-direction: column; align-items: center; pointer-events: none; z-index: 5; }
        .hud-top { position: absolute; top: 15px; width: 92%; display: flex; justify-content: space-between; align-items: center; pointer-events: none; }
        .stat-pill { background: rgba(255,255,255,0.9); padding: 6px 12px; border-radius: 20px; font-weight: 800; color: var(--red); font-size: 13px; border: 1px solid #eee; }
        .pause-btn { background: white; color: var(--red); border: 2px solid var(--red); width: 38px; height: 38px; border-radius: 50%; pointer-events: auto; }

        /* Leaderboard */
        .leaderboard { margin: 15px 0; background: #f9f9f9; border-radius: 12px; padding: 10px; font-size: 12px; }
        .lb-row { display: flex; justify-content: space-between; padding: 4px 0; border-bottom: 1px solid #eee; }
        .lb-row:last-child { border: none; }
        .lb-rank { font-weight: bold; color: var(--gold); margin-right: 5px; }

        /* Toast Notifications */
        #toast-container { position: absolute; top: 75px; width: 85%; z-index: 100; pointer-events: none; }
        .toast { background: white; padding: 12px; border-radius: 10px; border-left: 5px solid var(--gold); box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 8px; animation: slideIn 0.4s ease-out; font-size: 12px; font-weight: 600; }

        /* Trivia Box in Modals */
        .trivia-box { background: #fff9e6; padding: 12px; border-radius: 10px; margin: 10px 0; font-size: 13px; color: #555; font-style: italic; border-left: 4px solid var(--gold); }

        @keyframes slideIn { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body class="state-menu">

    <div style="display:none;">
        <img id="img-player" src="character.png" alt="Player">
    </div>

    <div id="ui-layer">
        <div id="start-screen" class="screen-box">
            <img src="NEW Seamex logo.png" alt="Seamex" class="responsive-logo">
            <h1 class="game-title">Seamless Dash</h1>
            <p class="powered-text">POWERED BY SEAMEX</p>
            <div class="input-group">
                <input type="text" id="inp-name" placeholder="Name" autocomplete="off">
                <div id="err-name" class="val-err">Invalid Name</div>
            </div>
            <div class="input-group">
                <input type="tel" id="inp-id" placeholder="Poornata ID" maxlength="10">
                <div id="err-id" class="val-err">Invalid Poornata ID</div>
            </div>
            <button id="btn-start" class="main-btn" disabled>START DASHING</button>
        </div>

        <div id="pause-screen" class="screen-box">
            <h1 class="game-title">Paused</h1>
            <div id="pause-trivia" class="trivia-box"></div>
            <button id="btn-resume" class="main-btn">RESUME GAME</button>
            <button id="btn-quit" class="secondary-btn">MAIN MENU</button>
        </div>

        <div id="game-over-screen" class="screen-box">
            <h1 class="game-title">Dash Over</h1>
            <div id="death-trivia" class="trivia-box"></div>
            <div class="leaderboard" id="leaderboard-ui">
                <div style="font-weight:900; margin-bottom:5px;">TOP DASHERS</div>
                <div id="lb-list"></div>
            </div>
            <button id="btn-restart" class="main-btn">PLAY AGAIN</button>
            <button id="btn-share" class="secondary-btn">CHALLENGE FRIENDS</button>
        </div>
    </div>

    <div id="game-hud">
        <div class="hud-top">
            <div class="stat-pill">üë§ <span id="hud-name">User</span></div>
            <div class="stat-pill">‚≠ê <span id="hud-score">0</span></div>
            <button id="btn-pause" class="pause-btn">||</button>
        </div>
        <div id="toast-container"></div>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d', { alpha: false });
    let W, H, animId;

    const TRIVIA = [
        "Poornata streamlines HR tasks for everyone.",
        "Did you know? Seamex supports 24/7 digital HR.",
        "Seamless Dash is built for mobile agility.",
        "Keep your profile updated on Poornata for accuracy.",
        "Seamex enables the future of Aditya Birla Group.",
        "A Gold Shield makes you invincible for 8 seconds.",
        "Time Warp slows the world, but your score keeps rising."
    ];

    const BG_COLORS = ['#f0f2f5', '#e3f2fd', '#fff3e0', '#f3e5f5', '#e8f5e9'];

    let state = {
        running: false, paused: false,
        score: 0, level: 1, speed: 4.5,
        timeWarp: false, shield: 0, frame: 0,
        currentUser: null
    };

    let entities = { player: { x:0, y:0, r:35, tx:0, ty:0 }, enemies: [], items: [] };

    const assets = {
        player: document.getElementById('img-player'),
        bgMusic: new Audio("https://cdn.jsdelivr.net/gh/joshua19881228/free-music-files@master/super-mario-bros-theme.mp3"),
        sfx: {
            lvl: new Audio("https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3"),
            die: new Audio("https://assets.mixkit.co/active_storage/sfx/2018/2018-preview.mp3"),
            shield: new Audio("https://assets.mixkit.co/active_storage/sfx/1103/1103-preview.mp3"),
            warp: new Audio("https://assets.mixkit.co/active_storage/sfx/600/600-preview.mp3")
        }
    };
    assets.bgMusic.loop = true; assets.bgMusic.volume = 0.25;

    function resize() {
        W = canvas.width = window.innerWidth;
        H = canvas.height = window.innerHeight;
        if(!state.running) { entities.player.x = entities.player.tx = W/2; entities.player.y = entities.player.ty = H*0.75; }
    }
    window.onresize = resize; resize();

    // Validation
    const nameIn = document.getElementById('inp-name');
    const idIn = document.getElementById('inp-id');
    const startBtn = document.getElementById('btn-start');

    function validate() {
        const nv = /^[A-Za-z ]{3,}$/.test(nameIn.value.trim());
        const iv = /^[0-9]{4,10}$/.test(idIn.value.trim());
        document.getElementById('err-name').style.visibility = nv ? 'hidden' : 'visible';
        document.getElementById('err-id').style.visibility = iv ? 'hidden' : 'visible';
        startBtn.disabled = !(nv && iv);
    }
    nameIn.oninput = idIn.oninput = validate;

    function startGame() {
        if(startBtn.disabled) return;
        state.currentUser = { name: nameIn.value.trim(), id: idIn.value.trim() };
        localStorage.setItem('seamex_last_user', JSON.stringify(state.currentUser));
        
        state.running = true; state.paused = false; state.score = 0; state.level = 1;
        state.speed = 4.5; state.shield = 0; state.timeWarp = false;
        entities.enemies = []; entities.items = [];
        
        document.body.className = 'state-playing';
        document.getElementById('hud-name').textContent = state.currentUser.name;
        assets.bgMusic.play().catch(()=>{});
        loop();
    }

    function endGame() {
        state.running = false;
        assets.bgMusic.pause();
        assets.sfx.die.play();
        
        // Save to Leaderboard
        let lb = JSON.parse(localStorage.getItem('seamex_lb') || '[]');
        lb.push({ name: state.currentUser.name, score: Math.floor(state.score) });
        lb.sort((a,b) => b.score - a.score);
        lb = lb.slice(0, 5);
        localStorage.setItem('seamex_lb', JSON.stringify(lb));

        // Render LB
        const list = document.getElementById('lb-list');
        list.innerHTML = lb.map((u, i) => `<div class="lb-row"><span><span class="lb-rank">#${i+1}</span> ${u.name}</span><b>${u.score}</b></div>`).join('');
        
        document.getElementById('death-trivia').textContent = TRIVIA[Math.floor(Math.random()*TRIVIA.length)];
        document.body.className = 'state-gameover';
    }

    // Input Logic
    const handleTouch = (e) => {
        if(!state.running || state.paused) return;
        const t = e.touches ? e.touches[0] : e;
        entities.player.tx = t.clientX;
        entities.player.ty = t.clientY - 60; // Ergonomic offset
    };
    canvas.addEventListener('touchstart', handleTouch);
    canvas.addEventListener('touchmove', handleTouch);

    function spawn() {
        // Progressive difficulty increase
        const levelMod = Math.min(state.level, 10);
        const rate = 0.015 + (levelMod * 0.005);
        
        if(Math.random() < rate) {
            entities.enemies.push({
                x: Math.random() * W, y: -40,
                r: 12 + Math.random() * 15,
                s: (2 + Math.random() * 2) * (1 + (levelMod * 0.05))
            });
        }
        if(Math.random() < 0.003) {
            entities.items.push({ x: Math.random() * W, y: -40, type: Math.random() > 0.6 ? 'shield' : 'warp' });
        }
    }

    function update() {
        if(state.paused) return;
        state.frame++;
        state.score += 0.15;
        document.getElementById('hud-score').textContent = Math.floor(state.score);

        // Smooth color shift every 80 pts
        const colorIdx = Math.floor(state.score / 80) % BG_COLORS.length;
        document.body.style.setProperty('--bg-current', BG_COLORS[colorIdx]);

        // Difficulty Step
        if(Math.floor(state.score) % 100 === 0 && state.frame % 60 === 0 && state.score > 0) {
            state.level++;
            if(state.level <= 10) state.speed += 0.3; // Speed cap
            assets.sfx.lvl.play();
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = TRIVIA[state.level % TRIVIA.length];
            document.getElementById('toast-container').appendChild(toast);
            setTimeout(() => toast.remove(), 4000);
        }

        // Movement
        entities.player.x += (entities.player.tx - entities.player.x) * 0.18;
        entities.player.y += (entities.player.ty - entities.player.y) * 0.18;

        const ts = state.timeWarp ? 0.45 : 1.0;
        if(state.shield > 0) state.shield--;
        if(state.timeWarp && Math.random() < 0.004) state.timeWarp = false;

        // Entities Update
        for(let i=entities.enemies.length-1; i>=0; i--) {
            let e = entities.enemies[i];
            e.y += (state.speed + e.s) * ts;
            const dist = Math.hypot(entities.player.x - e.x, entities.player.y - e.y);
            if(dist < entities.player.r + e.r - 8) {
                if(state.shield > 0) entities.enemies.splice(i, 1);
                else { endGame(); return; }
            }
            if(e.y > H + 50) entities.enemies.splice(i,1);
        }

        for(let i=entities.items.length-1; i>=0; i--) {
            let it = entities.items[i];
            it.y += state.speed * ts;
            if(Math.hypot(entities.player.x - it.x, entities.player.y - it.y) < 45) {
                if(it.type === 'shield') { state.shield = 480; assets.sfx.shield.play(); }
                else { state.timeWarp = true; assets.sfx.warp.play(); }
                entities.items.splice(i,1);
            }
            if(it.y > H + 50) entities.items.splice(i,1);
        }
        spawn();
    }

    function draw() {
        ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--bg-current');
        ctx.fillRect(0,0,W,H);

        // Player
        ctx.save();
        ctx.translate(entities.player.x, entities.player.y);
        if(state.shield > 0) {
            ctx.beginPath(); ctx.arc(0,0, 45 + Math.sin(state.frame*0.1)*5, 0, Math.PI*2);
            ctx.strokeStyle = '#0984e3'; ctx.lineWidth = 3; ctx.stroke();
        }
        if(assets.player.complete) ctx.drawImage(assets.player, -35, -35, 70, 70);
        else { ctx.fillStyle = '#A01018'; ctx.beginPath(); ctx.arc(0,0,30,0,Math.PI*2); ctx.fill(); }
        ctx.restore();

        // Enemies
        entities.enemies.forEach(e => {
            ctx.fillStyle = '#A01018';
            ctx.beginPath(); ctx.arc(e.x, e.y, e.r, 0, Math.PI*2); ctx.fill();
            ctx.fillStyle = 'rgba(255,255,255,0.2)';
            ctx.beginPath(); ctx.arc(e.x - e.r/3, e.y - e.r/3, e.r/3, 0, Math.PI*2); ctx.fill();
        });

        // Items
        entities.items.forEach(it => {
            ctx.font = "24px Arial";
            ctx.fillText(it.type === 'shield' ? "üõ°Ô∏è" : "‚è≥", it.x - 12, it.y + 10);
        });
    }

    function loop() {
        if(!state.running) return;
        update();
        draw();
        animId = requestAnimationFrame(loop);
    }

    // UI Listeners
    startBtn.onclick = startGame;
    document.getElementById('btn-pause').onclick = () => {
        state.paused = true;
        document.getElementById('pause-trivia').textContent = TRIVIA[Math.floor(Math.random()*TRIVIA.length)];
        document.body.className = 'state-paused';
    };
    document.getElementById('btn-resume').onclick = () => {
        state.paused = false;
        document.body.className = 'state-playing';
    };
    document.getElementById('btn-quit').onclick = () => location.reload();
    document.getElementById('btn-restart').onclick = startGame;
    document.getElementById('btn-share').onclick = () => {
        const msg = `I dashed ${Math.floor(state.score)} pts on Seamex Dash! Can you beat me?`;
        if(navigator.share) navigator.share({ text: msg }); else alert(msg);
    };

    // Auto-fill
    const last = JSON.parse(localStorage.getItem('seamex_last_user'));
    if(last) { nameIn.value = last.name; idIn.value = last.id; validate(); }

</script>
</body>
</html>
