<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Seamless Dash - Seamex</title>
    <style>
        :root { --red: #A01018; --gold: #FFC107; --blue: #0984e3; --bg: #f0f2f5; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: var(--bg); font-family: 'Segoe UI', sans-serif; touch-action: none; transition: background 2s; }
        canvas { display: block; z-index: 1; width: 100%; height: 100%; }

        /* UI Containers */
        #ui-layer { position: absolute; inset: 0; z-index: 10; pointer-events: none; display: flex; align-items: center; justify-content: center; }
        .screen-box { 
            background: white; padding: 25px; border-radius: 25px; width: 85%; max-width: 350px; 
            text-align: center; pointer-events: auto; box-shadow: 0 15px 40px rgba(0,0,0,0.2); 
            border-top: 8px solid var(--red); display: none; flex-direction: column;
        }

        /* State Visibility */
        body.state-menu #start-screen { display: flex; }
        body.state-gameover #game-over-screen { display: flex; }
        body.state-playing #game-hud { display: flex !important; }

        /* Typography & Branding */
        .logo { width: 130px; margin: 0 auto 10px; }
        .title { color: var(--red); font-size: 24px; font-weight: 900; margin: 0; text-transform: uppercase; }
        .sub-text { font-size: 11px; color: #888; font-weight: bold; margin-bottom: 15px; }
        .welcome-msg { background: #f9f9f9; padding: 10px; border-radius: 12px; margin-bottom: 15px; font-size: 14px; }

        /* Inputs & Buttons */
        input { width: 100%; padding: 14px; border: 2px solid #eee; border-radius: 12px; font-size: 16px; margin-bottom: 10px; box-sizing: border-box; }
        input:focus { border-color: var(--gold); outline: none; }
        .main-btn { background: linear-gradient(135deg, var(--gold), var(--red)); color: white; border: none; padding: 16px; border-radius: 50px; font-weight: 800; width: 100%; cursor: pointer; font-size: 15px; }
        .main-btn:disabled { opacity: 0.5; }
        .change-user-btn { background: none; border: none; color: var(--red); font-size: 12px; font-weight: bold; cursor: pointer; margin-top: 10px; text-decoration: underline; }

        /* HUD */
        #game-hud { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: none; pointer-events: none; z-index: 5; }
        .hud-item { background: rgba(255,255,255,0.9); padding: 8px 15px; border-radius: 20px; font-weight: 800; color: var(--red); font-size: 14px; border: 1px solid #eee; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .hud-top { position: absolute; top: 15px; width: 90%; left: 5%; display: flex; justify-content: space-between; }

        /* Toast */
        #toast { position: absolute; top: 80px; left: 50%; transform: translateX(-50%); background: var(--gold); color: white; padding: 10px 20px; border-radius: 30px; font-weight: bold; display: none; z-index: 100; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }

        /* Instructions */
        .instr-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; font-size: 12px; text-align: left; }
        .instr-item { display: flex; align-items: center; gap: 5px; font-weight: 600; }
    </style>
</head>
<body class="state-menu">

    <div style="display:none;">
        <img id="asset-player" src="character.png">
        <img id="asset-v1" src="icons8-virus-60.png">
        <img id="asset-v2" src="icons8-virus-60 (1).png">
        <img id="asset-shield" src="sheild.png">
    </div>

    <div id="ui-layer">
        <div id="start-screen" class="screen-box">
            <img src="NEW Seamex logo.png" class="logo">
            <h1 class="title">Seamless Dash</h1>
            <p class="sub-text">POWERED BY SEAMEX</p>

            <div id="user-display" style="display:none;">
                <div class="welcome-msg">Welcome back, <strong id="user-name-tag"></strong></div>
                <button class="main-btn" id="btn-quick-start">START DASHING</button>
                <button class="change-user-btn" id="btn-change-user"></button>
            </div>

            <div id="login-form">
                <input type="text" id="inp-name" placeholder="Name (Letters only)">
                <input type="tel" id="inp-id" placeholder="Poornata ID (Numbers only)">
                <div class="instr-grid">
                    <div class="instr-item"><img src="icons8-virus-60.png" width="20"> Avoid Viruses</div>
                    <div class="instr-item"><img src="sheild.png" width="20"> Get Shield</div>
                </div>
                <button id="btn-login-start" class="main-btn" disabled>LOGIN & PLAY</button>
            </div>
        </div>

        <div id="game-over-screen" class="screen-box">
            <h1 class="title">Dash Over</h1>
            <div id="trivia-box" style="background:#fff9e6; padding:15px; border-radius:15px; margin:15px 0; font-size:13px; font-style:italic;"></div>
            <button id="btn-restart" class="main-btn">TRY AGAIN</button>
            <button id="btn-home" class="change-user-btn" style="text-decoration:none">Back to Menu</button>
        </div>
    </div>

    <div id="game-hud">
        <div class="hud-top">
            <div class="hud-item">‚≠ê <span id="val-score">0</span></div>
            <div class="hud-item">üèÜ <span id="val-best">0</span></div>
        </div>
        <div id="toast">Place finger to start</div>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
    /**
     * SEAMLESS DASH V3.1
     * Fixes: Validation, Start Mechanic, Audio Assets
     */
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d', { alpha: false });
    let W, H, animId;

    const state = {
        phase: 'MENU', // MENU, READY, PLAYING, GAMEOVER
        score: 0, highscore: 0, level: 1,
        shield: 0, warp: 0,
        currentUser: null,
        bgIndex: 0
    };

    const BG_PALETTE = ['#f0f2f5', '#e3f2fd', '#fff3e0', '#f3e5f5', '#e8f5e9'];
    const TRIVIA = [
        "Poornata streamlines HR tasks for everyone.",
        "A Shield makes you invincible for 8 seconds.",
        "Dodge viruses to maintain your Seamex streak.",
        "Your highest score is saved on this device!"
    ];

    // Audio Setup
    const audio = {
        bgm: new Audio('bgm.mp3'),
        die: new Audio('Die.mp3'),
        lvl: new Audio('levelup.mp3'),
        pwr: new Audio('powerup.mp3')
    };
    audio.bgm.loop = true; audio.bgm.volume = 0.4;

    let entities = { player: { x:0, y:0, r:45, tx:0, ty:0 }, enemies: [], items: [], clouds: [] };

    function resize() {
        W = canvas.width = window.innerWidth;
        H = canvas.height = window.innerHeight;
        if(state.phase === 'MENU') { entities.player.x = W/2; entities.player.y = H*0.8; }
        entities.clouds = Array.from({length:5}, () => ({x:Math.random()*W, y:Math.random()*H, s:0.5+Math.random()}));
    }
    window.onresize = resize; resize();

    // Validation
    const nameIn = document.getElementById('inp-name');
    const idIn = document.getElementById('inp-id');
    const loginBtn = document.getElementById('btn-login-start');

    function validate() {
        const nameVal = /^[A-Za-z\s]{3,}$/.test(nameIn.value.trim());
        const idVal = /^[0-9]{4,10}$/.test(idIn.value.trim());
        loginBtn.disabled = !(nameVal && idVal);
    }
    nameIn.oninput = idIn.oninput = validate;

    // User Management
    function initApp() {
        const saved = localStorage.getItem('seamex_user');
        if(saved) {
            state.currentUser = JSON.parse(saved);
            document.getElementById('user-name-tag').textContent = state.currentUser.name;
            document.getElementById('btn-change-user').textContent = `Not ${state.currentUser.name}? Change User`;
            document.getElementById('user-display').style.display = 'block';
            document.getElementById('login-form').style.display = 'none';
        }
    }
    initApp();

    document.getElementById('btn-change-user').onclick = () => {
        localStorage.removeItem('seamex_user');
        location.reload();
    };

    function startReady() {
        if(state.currentUser === null) {
            state.currentUser = { name: nameIn.value.trim(), id: idIn.value.trim() };
            localStorage.setItem('seamex_user', JSON.stringify(state.currentUser));
        }
        state.highscore = localStorage.getItem('seamex_hs_'+state.currentUser.id) || 0;
        document.getElementById('val-best').textContent = state.highscore;
        
        state.phase = 'READY';
        state.score = 0; state.level = 1; state.shield = 0;
        entities.enemies = []; entities.items = [];
        
        document.body.className = 'state-playing';
        document.getElementById('toast').style.display = 'block';
        if(animId) cancelAnimationFrame(animId);
        loop();
    }

    document.getElementById('btn-login-start').onclick = startReady;
    document.getElementById('btn-quick-start').onclick = startReady;
    document.getElementById('btn-restart').onclick = startReady;
    document.getElementById('btn-home').onclick = () => location.reload();

    // Game Input
    const onDown = (e) => {
        if(state.phase === 'READY') {
            state.phase = 'PLAYING';
            document.getElementById('toast').style.display = 'none';
            audio.bgm.play().catch(()=>{});
        }
        updateTarget(e);
    };

    const onUp = () => {
        if(state.phase === 'PLAYING') endGame();
    };

    const updateTarget = (e) => {
        const t = e.touches ? e.touches[0] : e;
        entities.player.tx = t.clientX;
        entities.player.ty = t.clientY - 65; // Offset for finger
    };

    canvas.addEventListener('touchstart', (e) => { e.preventDefault(); onDown(e); });
    canvas.addEventListener('touchmove', (e) => { e.preventDefault(); updateTarget(e); });
    canvas.addEventListener('touchend', onUp);
    canvas.addEventListener('mousedown', onDown);
    canvas.addEventListener('mouseup', onUp);

    function spawn() {
        if(state.phase !== 'PLAYING') return;
        const rate = 0.015 + (Math.min(state.level, 10) * 0.005);
        if(Math.random() < rate) {
            entities.enemies.push({
                x: Math.random()*W, y: -50, r: 20+Math.random()*25, 
                s: 3 + Math.random()*3 + (state.level*0.3),
                img: Math.random() > 0.5 ? document.getElementById('asset-v1') : document.getElementById('asset-v2'),
                rot: Math.random()*Math.PI*2, rs: (Math.random()-0.5)*0.1
            });
        }
        if(Math.random() < 0.004) {
            entities.items.push({ x: Math.random()*W, y: -50, type: 'shield' });
        }
    }

    function endGame() {
        state.phase = 'GAMEOVER';
        audio.bgm.pause();
        audio.die.play();
        if(state.score > state.highscore) {
            localStorage.setItem('seamex_hs_'+state.currentUser.id, Math.floor(state.score));
        }
        document.getElementById('trivia-box').textContent = TRIVIA[Math.floor(Math.random()*TRIVIA.length)];
        document.body.className = 'state-gameover';
    }

    function update() {
        if(state.phase === 'READY') {
            // Hover effect while waiting
            entities.player.x = W/2 + Math.sin(Date.now()*0.005)*10;
            entities.player.y = H*0.7;
            return;
        }
        if(state.phase !== 'PLAYING') return;

        state.score += 0.15;
        document.getElementById('val-score').textContent = Math.floor(state.score);

        // Background Shift
        const newIdx = Math.floor(state.score / 80) % BG_PALETTE.length;
        if(newIdx !== state.bgIndex) {
            state.bgIndex = newIdx;
            document.body.style.background = BG_PALETTE[newIdx];
        }

        // Level Up
        if(Math.floor(state.score) > 0 && Math.floor(state.score) % 100 === 0 && state.score % 1 < 0.2) {
            state.level++;
            audio.lvl.play();
        }

        // Smooth Movement
        entities.player.x += (entities.player.tx - entities.player.x) * 0.2;
        entities.player.y += (entities.player.ty - entities.player.y) * 0.2;

        if(state.shield > 0) state.shield--;

        // Enemies
        for(let i=entities.enemies.length-1; i>=0; i--) {
            let e = entities.enemies[i];
            e.y += e.s; e.rot += e.rs;
            const dist = Math.hypot(entities.player.x - e.x, entities.player.y - e.y);
            if(dist < entities.player.r + e.r - 10) {
                if(state.shield > 0) entities.enemies.splice(i,1);
                else { endGame(); return; }
            }
            if(e.y > H + 100) entities.enemies.splice(i,1);
        }

        // Items
        for(let i=entities.items.length-1; i>=0; i--) {
            let it = entities.items[i];
            it.y += 4;
            if(Math.hypot(entities.player.x - it.x, entities.player.y - it.y) < 60) {
                state.shield = 480;
                audio.pwr.play();
                entities.items.splice(i,1);
            }
        }
        
        entities.clouds.forEach(c => { c.y += c.s; if(c.y > H) c.y = -50; });
        spawn();
    }

    function draw() {
        ctx.fillStyle = getComputedStyle(document.body).background;
        ctx.fillRect(0,0,W,H);

        // Clouds
        ctx.fillStyle = 'rgba(255,255,255,0.4)';
        entities.clouds.forEach(c => { ctx.beginPath(); ctx.arc(c.x, c.y, 40, 0, Math.PI*2); ctx.fill(); });

        // Enemies
        entities.enemies.forEach(e => {
            ctx.save();
            ctx.translate(e.x, e.y);
            ctx.rotate(e.rot);
            ctx.drawImage(e.img, -e.r, -e.r, e.r*2, e.r*2);
            ctx.restore();
        });

        // Items
        entities.items.forEach(it => {
            ctx.drawImage(document.getElementById('asset-shield'), it.x-25, it.y-25, 50, 50);
        });

        // Player
        ctx.save();
        if(state.shield > 0) {
            ctx.beginPath(); ctx.arc(entities.player.x, entities.player.y, 55, 0, Math.PI*2);
            ctx.strokeStyle = '#0984e3'; ctx.lineWidth = 5; ctx.stroke();
        }
        ctx.drawImage(document.getElementById('asset-player'), entities.player.x-45, entities.player.y-45, 90, 90);
        ctx.restore();
    }

    function loop() {
        update();
        draw();
        animId = requestAnimationFrame(loop);
    }

    loop();
</script>
</body>
</html>
